{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Panel - Pruebas{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Project styles: reuse same styles as index -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    {% block extra_head %}{% endblock %}
    <style>
        /* Simple layout tweaks to ensure sidebar + content spacing */
        /* Compensate for the fixed header to avoid overlap with sidebar/content */
        body {
            padding-top: 80px; /* header height in main CSS */
            background-color: var(--main-bg-color);
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            body { padding-top: 70px; }
        }

        /* Sidebar: use the same dark sidebar variables from main.css for contrast */
        .sidebar {
            min-height: 100vh;
            background: var(--sidebar-bg-color, #1b355d);
            color: var(--light-text, #f8f9fa);
            border-right: 1px solid rgba(0,0,0,.05);
            padding-top: 1rem;
        }

        .sidebar .nav-link {
            color: var(--light-text, #f8f9fa);
        }

        .sidebar .nav-link.active {
            background: rgba(255,255,255,0.06);
            font-weight: 600;
            color: var(--light-text, #f8f9fa);
        }

        /* Main content area should use the page background and readable text color */
        .content-area {
            padding: 2rem;
            background: transparent;
            color: var(--text-color, #333);
        }

        /* Ensure tables and form controls inside content are readable */
        .content-area table,
        .content-area th,
        .content-area td {
            color: var(--text-color, #333) !important;
        }

        .content-area .form-control,
        .content-area .form-select {
            background-color: #fff;
            color: var(--text-color, #333);
            border: 1px solid var(--border-color, #dee2e6);
        }
        /* Navbar layout: fix logo to corner, center the clock, keep actions on the right */
        .header .container { position: relative; }
        .header .logo { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); z-index: 5; }
        #navbar-clock { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 5; }
        .header .actions { position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); z-index: 5; }
        /* Ensure header has enough height for fixed positioning */
        .header { min-height: 56px; }
    </style>
</head>
<body>
    <!-- Reusable navbar (based on index.html) -->
    <header class="header">
        <div class="container header-wrapper d-flex justify-content-between align-items-center">
            <a href="{% url 'login' %}" class="logo d-flex align-items-center text-decoration-none">
                <i class="fas fa-industry me-2"></i>
                <span class="h5 mb-0">AgroTrack</span>
            </a>
            <div id="navbar-clock" class="fw-bold text-nowrap" style="font-size:1rem;"><i class="fa fa-clock me-1"></i><span id="clock-time"></span></div>
            <div class="actions d-flex align-items-center gap-3">
                <a href="{% url 'logout' %}" class="btn btn-outline-light"><i class="fas fa-sign-out-alt me-1"></i> Cerrar sesión</a>
            </div>
        </div>
    </header>

    <!-- Toast container (global) -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index: 1080; min-width: 300px;">
        <div id="toast-container"></div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <aside class="col-md-3 col-lg-2 sidebar d-none d-md-block">
                <div class="px-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'control' %}"><i class="fas fa-list me-2"></i>Control de entradas </a>
                            <a class="nav-link" href="{% url 'control_personas' %}"><i class="fas fa-users me-2"></i>Control de personas </a>
                            <a class="nav-link" href="{% url 'reportes' %}"><i class="fas fa-chart-bar me-2"></i>Reportes </a>
                            <a class="nav-link" href="{% url 'control_usuarios' %}"><i class="fas fa-user-cog me-2"></i>Usuarios</a>
                            <a class="nav-link" href="{% url 'auditoria' %}"><i class="fas fa-search me-2"></i>Auditoría</a>
                                
                        </li>
                        <li class="nav-item">
                    </ul>
                </div>
            </aside>

            <!-- Main content area -->
            <main class="col-12 col-md-9 col-lg-10 content-area">
                {% if messages %}
                    {% for message in messages %}
                    {% endfor %}
                {% endif %}

                {% block content %}{% endblock %}
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Toast utility (global)
    function showToast(message, type="info") {
        const toastId = "toast-" + Math.random().toString(36).substr(2, 9);
        const colors = {
            info: "bg-info text-white",
            danger: "bg-danger text-white",
            success: "bg-success text-white",
            warning: "bg-warning text-dark",
            secondary: "bg-secondary text-white"
        };
        const color = colors[type] || colors.info;
        const toastHtml = `\n    <div id="${toastId}" class="toast align-items-center ${color}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">\n      <div class="d-flex">\n        <div class="toast-body">${message}</div>\n        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>\n      </div>\n    </div>`;
        const container = document.getElementById('toast-container');
        if (container) {
            container.insertAdjacentHTML('beforeend', toastHtml);
            const toastElem = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElem);
            toast.show();
            toastElem.addEventListener('hidden.bs.toast', () => toastElem.remove());
        }
    }

    // Mostrar mensajes de Django (si existen) como toasts
    document.addEventListener('DOMContentLoaded', function() {
        {% if message %}
            showToast("{{ message|escapejs }}", "info");
        {% endif %}
        {% if error %}
            showToast("{{ error|escapejs }}", "danger");
        {% endif %}
        {% if messages %}
            {% for m in messages %}
                {% if 'no-toast' not in m.tags %}
                    showToast("{{ m|escapejs }}", "{% if m.tags %}{{ m.tags }}{% else %}info{% endif %}");
                {% endif %}
            {% endfor %}
        {% endif %}
    });

    // Reloj Venezuela (disponible en todas las páginas)
    function updateVenezuelaClock() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const venezuela = new Date(utc - (4 * 60 * 60 * 1000));
        const h = venezuela.getHours().toString().padStart(2, '0');
        const m = venezuela.getMinutes().toString().padStart(2, '0');
        const s = venezuela.getSeconds().toString().padStart(2, '0');
        const el = document.getElementById('clock-time');
        if (el) el.textContent = `${h}:${m}:${s}`;
    }
    document.addEventListener('DOMContentLoaded', function() {
        updateVenezuelaClock();
        setInterval(updateVenezuelaClock, 1000);
    });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
